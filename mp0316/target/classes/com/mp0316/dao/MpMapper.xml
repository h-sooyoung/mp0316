<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="com.mp0316.dao.MpMapper">
  
  	<select id="logincheck" resultType="com.mp0316.dto.MemberDTO">
 		select * from member
 		where id=#{id} and pw=#{pw}
  	</select>
  	
  	<select id="memberinfo" resultType="hashmap">
  		select
             a.id as id
            ,a.pw as pw
  			,b.name as name
  			,b.member_seq as member_seq
            ,b.addr1 as addr1
            ,b.addr2 as addr2
            ,b.birth as birth
            ,b.reg as reg
            ,b.email as email
  			,c.name as gen
            ,d.memo as memo
  		from member a,memberinfo b,gen c, memberlog d
  		where b.gen = c.gen_seq(+)
  		and b.member_seq = a.member_seq(+)
        and d.member_seq(+) = a.member_seq
  		and a.id = #{id}
  	</select>
  	
  	<update id="memberupdate" parameterType="com.mp0316.dto.MemberinfoDTO">
  		update memberinfo set 
			name=#{name},
			email=#{email},
			tel=#{tel},
			addr1=#{addr1},
			addr2=#{addr2}
  		where member_seq=#{member_seq}
  	</update>
  	
  	<select id="memberinforead" resultType="com.mp0316.dto.MemberinfoDTO">
  		select distinct memberinfo.*, member.id memid
  		from memberinfo, member  
  		where memberinfo.member_seq = member.member_seq 
  		and memberinfo.member_seq=#{seq}
  	</select>
  	
  	<insert id="joinmember" parameterType="hashmap">
  		insert into member(member_seq,id,pw)
  					values(member_seq.nextval,#{id},#{pw})
  	</insert>
  	
  	<insert id="joinmember2" parameterType="hashmap">
  			insert into memberinfo(memberinfo_seq,member_seq,name,birth,gen,email,tel,addr1,addr2,reg)
  						values(memberinfo_seq.nextval,#{member_seq},#{name},#{birth},#{gen},#{email},#{tel},#{addr1},#{addr2},sysdate)
  	</insert>
  	
  	<select id="findseq" resultType="int"> 
  		select member_seq
  		from (select * from member_seq order by member_seq desc) 
  		where member_seq = #{member_seq}
  	</select>
  </mapper>